---

#- name: Podman garbage collection on any old containers *will clear out most contianers*
#  ansible.builtin.shell: sudo podman system prune -a -f
#  changed_when: false

- name: Creating working directory
  file: 
    path: "mkdir {{ ee_path }}"
    state: directory
    mode: '0777'

- name: Copy config files to the working directory
  copy:
    src: "{{ item }}"
    dest: "/tmp/{{ item }}"
  with_items:
    - ansible.cfg
    - execution-environment.yml
    - requirements.yml
    - requirements.txt
    - bindep.txt
  become: yes

- name: Run ansible-builder command
  command:
    cmd: "{{ ansible_builder_cmd }}"
    #cmd: "mkdir {{ ee_image }}1"
    chdir: "{{ ee_path }}"

- name: Push image to image registry
  command: 
    #cmd: "{{ ee_registry_cmd }}"
    cmd: "mkdir {{ ee_image }}2"
    chdir: "{{ ee_path }}"
